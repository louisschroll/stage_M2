---
title: "Split datasets repro / non-repro"
author: "Louis Schroll"
date: "2024-02-28"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = FALSE, warning = F)
```

```{r}
load("~/stage_M2/1.data/all_seabirds_counts.rdata")
```


```{r}
library(tidyverse)
library(knitr)
library(sf)

count_by_session <- function(data_obs, species){
  cbs <- data_obs %>% as_tibble() %>% 
    filter(nom_fr == species) %>% 
    group_by(session) %>% 
    count()
  
  tot <- data_obs %>% as_tibble() %>% 
    filter(session %in% cbs$session) %>% 
    group_by(session) %>% 
    count()
  
  cbs$proportion <- round(cbs$n / tot$n * 100, 1)
  
  date_df <- data_obs %>% as_tibble() %>% group_by(session) %>% summarise(begin = min(date), end = max(date))
  
  final_df <- full_join(date_df, cbs, by = join_by(session)) %>% 
    rename(count = n)
  return(final_df)
}

migralion_obs$species_name <- NA
pelmed_obs$species_name <- NA
pnm_obs$species_name <- NA
samm_obs$species_name <- NA

split_periods <- function(data_obs, species, session_summer, session_winter){
  data_obs %>% 
    mutate(species_name = ifelse(session %in% session_summer & nom_fr == species, 
                                        paste0(str_replace(species, " ", "_"), "_summer"),
                                       species_name)) %>% 
    mutate(species_name = ifelse(session %in% session_winter & nom_fr == species, 
                                        paste0(str_replace(species, " ", "_"), "_winter"),
                                       species_name))
}
```


## Fou de bassan / Northern gannet

Presence: y-round

Reproduction: not here

**Split data: **

```{r}
species <- "fou de bassan"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Goeland leucophee / Yellow-legged Gull

Presence: year-round 

Reproduction: from March to July

**Split data:**

  - **Outside repro: migralion data postnup sessions, Megaobs data autumn sessions, SAMM data winter sessions**

  - **During repro: migralion data, prenup sessions, Megaobs data, spring sessions, Pelmed**
  
  
```{r}
species <- "goeland leucophee"

count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```

## Mouette melanocephale / Mediterranean gull

Presence: y-round

Reproduction: mi-mars à début juillet

**Split data:**

  - **During repro: migralion prenup sessions, pelmed**
  
  - **Outside repro: migralion data postnup sessions, Megaobs data automn sessions, SAMM data winter sessions**

```{r}
species <- "mouette melanocephale"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Mouette pygmée / Little gull

Presence: winter - spring

Repro :may to end of July

**Keep data: Migralion, prenup sessions, SAMM, winter sessions**

```{r}
species <- "mouette pygmee"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```

```{r}
samm_obs <- samm_obs %>% 
  mutate(species_name = ifelse(session %in% c("SAMM1(1winter)", "SAMM2(1winter)") 
                               & nom_fr == "mouette pygmee",
                               "mouette_pygmee_winter", species_name))

migralion_obs <- migralion_obs %>% 
  mutate(species_name = ifelse(session %in% c("prenup2022", "prenup2023") 
                               & nom_fr == "mouette pygmee",
                               "mouette_pygmee_winter", species_name))
```




## Mouette rieuse / Black-headed gull

Presence: 

Reproduction: 

**Split data:**

  - **During repro: X**
  
  - **Outside repro: PNM autumn, SAMM winter, migralion postnup**


```{r}
species <- "mouette rieuse"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```



## Oceanite tempete / Storm petrel

Presence: 

Reproduction: mai à fin juillet

**Split data:**

  - **During repro: PNM printemps, Pelmed sauf 2020?, Migralion prenup**
  
  - **Outside repro: X**
  

```{r}
species <- "oceanite tempete"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Petits puffins / Small shearwaters

Presence: year-round for Yelkouan, and for balearic

Reproduction: from March to July

**Split data**:

  - **During repro: migralion data (?), prenup sessions, Megaobs data, spring sessions, Pelmed**
  
  - **Outside repro: migralion data postnup sessions, Megaobs data autumn sessions, SAMM data winter sessions**

```{r}
species <- "petit puffin"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```




## Puffin de Scopoli / Scopoli's shearwater

Presence: repro, puis hivernage au large

Reproduction: avril - mai à septembre-octobre

**Split data:**

  - **During repro: PNM printemps, PELMED, Migralion**
  
  - **Outside repro: nothing**


```{r}
species <- "puffin de scopoli"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Sandwich terns / Sternes caugek

Presence: y-round

Reproduction: mars-avril à juillet

**Split data:**

  - **During repro: migralion, prenup sessions, Megaobs, spring sessions, Pelmed**
  
  - **Outside repro: migralion data postnup sessions, Megaobs data automn sessions, SAMM winter sessions**

```{r}
species <- "sterne caugek"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Common tern / Sterne pierregarin

Hautement migratrice, la Sterne pierregarin quitte totalement ses sites de reproduction à partir de la mi-août et dans le courant du mois de septembre. A partir de la fin de l’été, des rassemblements importants d’oiseaux peuvent être notés sur le littoral, principalement vers la fin août et en début septembre. Quelques rares observations hivernales sont effectuées chaque année en France, concernant à chaque fois des individus isolés. 
Les premiers migrateurs arrivent en France de la fin mars au début du mois d’avril, les individus les plus précoces étant notés au début du mois de mars, voire dès la mi-février en Méditerranée et sur la façade atlantique. 

Presence: 

Reproduction: avril à juillet

**Split data:**

  - **During repro: Migralion prenup, PELMED sauf 2020**
  
  - **Outside repro: X**

```{r}
species <- "sterne pierregarin"
count_by_session(migralion_obs, species) %>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) %>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) %>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) %>% kable(format = "markdown", caption = "Megaobs - PNM")
```



## Labbe

Presence: y-round

Reproduction: mars-avril à juillet

**Split data:**

  - **During repro: migralion, prenup sessions, Megaobs, spring sessions, Pelmed**
  
  - **Outside repro: migralion data postnup sessions, Megaobs data automn sessions, SAMM winter sessions**

```{r}
species <- "labbe pomarin"
count_by_session(migralion_obs, species) #%>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) #%>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) #%>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) #%>% kable(format = "markdown", caption = "Megaobs - PNM")
```


## Macareux moine

Presence: 

Reproduction: 



```{r}
species <- "macareux moine"
count_by_session(migralion_obs, species) #%>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) #%>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) #%>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) #%>% kable(format = "markdown", caption = "Megaobs - PNM")
```

# grand cormoran

```{r}
species <- "grand cormoran"
count_by_session(migralion_obs, species) #%>% kable(format = "markdown", caption = "Migralion")
count_by_session(samm_obs, species) #%>% kable(format = "markdown", caption = "SAMM")
count_by_session(pelmed_obs, species) #%>% kable(format = "markdown", caption = "Pelmed")
count_by_session(pnm_obs, species) #%>% kable(format = "markdown", caption = "Megaobs - PNM")
```
